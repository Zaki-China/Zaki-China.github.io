<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>PXC集群搭建 | Zaki&#39;s blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Zaki's blog">
    <meta name="author" content="Zaki">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Zaki&#39;s blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/googlecode.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Zaki's blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->

        <!-- ============================ Hero Image =========================== -->

        <section id="hero" class="scrollme">
            <div class="container-fluid element-img" style="background: url(/img/1.jpg) no-repeat center center fixed;background-size: cover">
                <div class="row">
                    <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 vertical-align cover boost text-center">
                        <div class="center-me animateme" data-when="exit" data-from="0" data-to="0.6" data-opacity="0" data-translatey="100">
                            <div>
                            	
                                <h2>YOU'VE MADE A <span>BRAVE</span> DECISION, WELCOME.</h2>
                                <p></p>
				    			
                                <h2></h2>
                                <p>每一个不曾起舞的日子都是对生命的辜负。</p>
				    			

                            </div>
                        </div>
                    </div>
                    <!-- // .col-md-12 -->
                </div>
                <div class="herofade beige-dk"></div>
            </div>
        </section>

        <!-- Height spacing helper -->
        <div class="heightblock"></div>
        <!-- // End height spacing helper -->

        <!-- ============================ END Hero Image =========================== -->
      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2016-04-08T06:11:05.000Z" itemprop="datePublished">
          2016-04-08
      </time>
    
    
    | 
    <a href='/tags/PXC集群/'>PXC集群</a>
    
    
</span>
                <h1>PXC集群搭建</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>#PXC集群搭建</p>
<p>###环境情况：<br>OS: centos release 6.6</p>
<table>
<thead>
<tr>
<th style="text-align:center">server</th>
<th style="text-align:center">Hostname</th>
<th style="text-align:center">ip</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">PXC</td>
<td style="text-align:center">node1</td>
<td style="text-align:center">192.168.42.135</td>
</tr>
<tr>
<td style="text-align:center">PXC</td>
<td style="text-align:center">node2</td>
<td style="text-align:center">192.168.42.136</td>
</tr>
<tr>
<td style="text-align:center">PXC</td>
<td style="text-align:center">node3</td>
<td style="text-align:center">192.168.42.137</td>
</tr>
</tbody>
</table>
<h3 id="一、PXC的优缺点"><a href="#一、PXC的优缺点" class="headerlink" title="一、PXC的优缺点"></a>一、PXC的优缺点</h3><h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><p><strong>①.</strong>数据同步复制(并发复制)，几乎无延迟；<br><strong>②.</strong>多个可同时读写节点，可实现写扩展，不过最好事先进行分库分表，让各个节点分别写不同的表或者库，避免让galera解决数据冲突；<br><strong>③.</strong>新节点可以自动部署，部署操作简单；<br><strong>④.</strong>数据严格一致性，尤其适合电商类应用；<br><strong>⑤.</strong>完全兼容MySQL；<br><strong>⑥.</strong>虽然有这么多好处，但也有些局限性：<br><strong>⑦.</strong>服务高可用；</p>
<h4 id="缺陷："><a href="#缺陷：" class="headerlink" title="缺陷："></a>缺陷：</h4><p><strong>①.</strong>只支持InnoDB引擎；<br><strong>②.</strong>所有表都要有主键；<br><strong>③.</strong>不支持LOCK TABLE等显式锁操作；<br><strong>④.</strong>锁冲突、死锁问题相对更多；<br><strong>⑤.</strong>不支持XA；<br><strong>⑥.</strong>集群吞吐量/性能取决于短板；<br><strong>⑦.</strong>新加入节点采用SST时代价高；<br><strong>⑧.</strong>存在写扩大问题；<br><strong>⑨.</strong>如果并发事务量很大的话，建议采用InfiniBand网络，降低网络延迟；</p>
<p><strong>事实上，采用PXC的主要目的是解决数据的一致性问题，高可用是顺带实现的。因为PXC存在写扩大以及短板效应，并发效率会有较大损失，类似semi sync replication机制。</strong></p>
<h3 id="二、PXC和M-S（主从同步）的对比"><a href="#二、PXC和M-S（主从同步）的对比" class="headerlink" title="二、PXC和M/S（主从同步）的对比"></a>二、PXC和M/S（主从同步）的对比</h3><table>
<thead>
<tr>
<th style="text-align:center">\</th>
<th style="text-align:center">PXC</th>
<th style="text-align:center">M/S</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据同步复制，无延迟</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">数据异步复制</td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">一致性（所有节点的数据一致）</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">可用性（一个或多个节点失效，不影响服务请求。）</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">分区容忍性（节点间的连接失效，仍然可以处理请求。）</td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">执行查询查询本地</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">多个库的同时读写</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">支持的存储引擎</td>
<td style="text-align:center">innodb</td>
<td style="text-align:center">ALL</td>
</tr>
<tr>
<td style="text-align:center">表结构</td>
<td style="text-align:center">特殊</td>
<td style="text-align:center">一般</td>
</tr>
<tr>
<td style="text-align:center">锁冲突、死锁问题</td>
<td style="text-align:center">较多</td>
<td style="text-align:center">较少</td>
</tr>
<tr>
<td style="text-align:center">是否支持XA</td>
<td style="text-align:center">NO</td>
<td style="text-align:center">YES</td>
</tr>
<tr>
<td style="text-align:center">新加入节点</td>
<td style="text-align:center">代价较大</td>
<td style="text-align:center">相对简单</td>
</tr>
<tr>
<td style="text-align:center">脑裂</td>
<td style="text-align:center">可以防止</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">处理并发大事务</td>
<td style="text-align:center">不能</td>
<td style="text-align:center">能</td>
</tr>
</tbody>
</table>
<p>###三、PXC集群搭建</p>
<p>####1、关闭集群的防火墙和selinux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#即时关闭防火墙</span><br><span class="line">service iptables stop</span><br><span class="line">#永久关闭防火墙</span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#永久禁用，需要重启生效。</span><br><span class="line">sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/g&apos; /etc/selinux/config  </span><br><span class="line">#临时禁用，不需要重启</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure>
<h4 id="2、修改主机名"><a href="#2、修改主机名" class="headerlink" title="2、修改主机名"></a>2、修改主机名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#在每个节点上的hosts里面加入</span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.42.135 node1</span><br><span class="line">192.168.42.136 node2</span><br><span class="line">192.168.42.137 node3</span><br><span class="line">#修改为本机应该的节点名</span><br><span class="line">vim /etc/sysconfig/network</span><br><span class="line">hostname=node（1、2、3）</span><br><span class="line">#重启网络服务</span><br><span class="line">service network restart</span><br><span class="line">#查看主机名和主机名对应的IP</span><br><span class="line">hostname</span><br><span class="line">hostname -i</span><br></pre></td></tr></table></figure>
<h4 id="3、实现3个节点之间的无密码登录"><a href="#3、实现3个节点之间的无密码登录" class="headerlink" title="3、实现3个节点之间的无密码登录"></a>3、实现3个节点之间的无密码登录</h4><p>1）在所有节点上执行：<br><code>ssh-keygen -t rsa</code><br> 2）将所有机子上公钥（<code>id_rsa.pub</code>）导到一个主机的<code>/root/.ssh/authorized_keys</code>文件中,然后将<code>authorized_keys</code>分别拷贝到所有主机上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#在192.168.42.137上操作</span><br><span class="line">cat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</span><br><span class="line">#将192.168.42.136上的公钥拷到137本地</span><br><span class="line">ssh root@192.168.42.135  cat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</span><br><span class="line">#将192.168.42.135上的公钥拷到137本地</span><br><span class="line">ssh root@192.168.42.136  cat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</span><br><span class="line">#拷贝到135服务器上</span><br><span class="line">scp /root/.ssh/authorized_keys root@192.168.42.135:/root/.ssh/authorized_keys</span><br><span class="line">#拷贝到136服务器上</span><br><span class="line">scp /root/.ssh/authorized_keys root@192.168.42.136:/root/.ssh/authorized_keys</span><br><span class="line">#测试是否免密登录</span><br><span class="line">ssh 192.168.42.136</span><br><span class="line">ssh 192.168.42.135</span><br></pre></td></tr></table></figure>
<p>··············································································<br>（更新后的方法，使用<code>ssh-copy-id</code>远程传公钥）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#创建公钥</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">#把公钥追加到其他需要免密登录的服务器</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.135</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.136</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.137</span><br><span class="line">#测试免密登录</span><br><span class="line">[root@node1 .ssh]# ssh 192.168.42.137</span><br><span class="line">Last login: Tue Mar 22 23:29:55 2016 from 192.168.42.1</span><br><span class="line">[root@node3 ~]#</span><br></pre></td></tr></table></figure>
<h4 id="4、安装percona环境"><a href="#4、安装percona环境" class="headerlink" title="4、安装percona环境"></a>4、安装percona环境</h4><h5 id="1）配置yum源："><a href="#1）配置yum源：" class="headerlink" title="1）配置yum源："></a>1）配置yum源：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm</span><br><span class="line">yum -y install epel*</span><br></pre></td></tr></table></figure>
<h5 id="2）安装Percona软件："><a href="#2）安装Percona软件：" class="headerlink" title="2）安装Percona软件："></a>2）安装Percona软件：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install Percona-XtraDB-Cluster-server Percona-XtraDB-Cluster-client Percona-Server-shared-compat percona-xtrabackup</span><br></pre></td></tr></table></figure>
<h5 id="3）添加账号"><a href="#3）添加账号" class="headerlink" title="3）添加账号"></a>3）添加账号</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/mysql bootstrap-pxc     //启动PXC</span><br><span class="line">mysql</span><br><span class="line">----------------------------------------&gt;</span><br><span class="line">grant all privileges on *.* to &apos;sst&apos;@localhost identified by &apos;123456&apos;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">&lt;----------------------------------------</span><br><span class="line">/etc/init.d/mysql stop</span><br></pre></td></tr></table></figure>
<h4 id="5、PXC的节点配置"><a href="#5、PXC的节点配置" class="headerlink" title="5、PXC的节点配置"></a>5、PXC的节点配置</h4><h5 id="1）135："><a href="#1）135：" class="headerlink" title="1）135："></a>1）135：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">serv-id = 1</span><br><span class="line"># Percona XtraDB Cluster</span><br><span class="line">wsrep_provider=/usr/lib64/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address=&quot;gcomm://192.168.42.135,192.168.42.136,192.168.42.137&quot;</span><br><span class="line">wsrep_sst_auth=sst:123456</span><br><span class="line">wsrep_cluster_name=Percona</span><br><span class="line">wsrep_sst_method=xtrabackup-v2</span><br><span class="line">wsrep_node_address=192.168.42.135</span><br><span class="line">wsrep_slave_threads=2</span><br><span class="line">innodb_locks_unsafe_for_binlog=1</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#启动第一个节点</span><br><span class="line">/etc/init.d/mysql bootstrap-pxc</span><br></pre></td></tr></table></figure>
<h5 id="2）136"><a href="#2）136" class="headerlink" title="2）136"></a>2）136</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">serv-id = 2</span><br><span class="line"># Percona XtraDB Cluster</span><br><span class="line">wsrep_provider=/usr/lib64/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address=&quot;gcomm://192.168.42.135,192.168.42.136,192.168.42.137&quot;</span><br><span class="line">wsrep_sst_auth=sst:123456</span><br><span class="line">wsrep_cluster_name=Percona</span><br><span class="line">wsrep_sst_method=xtrabackup-v2</span><br><span class="line">wsrep_node_address=192.168.42.136</span><br><span class="line">wsrep_slave_threads=2</span><br><span class="line">innodb_locks_unsafe_for_binlog=1</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#启动第二个节点</span><br><span class="line">/etc/init.d/mysql start</span><br></pre></td></tr></table></figure>
<h5 id="3）137"><a href="#3）137" class="headerlink" title="3）137"></a>3）137</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">serv-id = 3</span><br><span class="line"># Percona XtraDB Cluster</span><br><span class="line">wsrep_provider=/usr/lib64/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address=&quot;gcomm://192.168.42.135,192.168.42.136,192.168.42.137&quot;</span><br><span class="line">wsrep_sst_auth=sst:123456</span><br><span class="line">wsrep_cluster_name=Percona</span><br><span class="line">wsrep_sst_method=xtrabackup-v2</span><br><span class="line">wsrep_node_address=192.168.42.137</span><br><span class="line">wsrep_slave_threads=2</span><br><span class="line">innodb_locks_unsafe_for_binlog=1</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#启动第三个节点</span><br><span class="line">/etc/init.d/mysql start</span><br></pre></td></tr></table></figure>
<h5 id="4）随便进一个节点查看集群状态"><a href="#4）随便进一个节点查看集群状态" class="headerlink" title="4）随便进一个节点查看集群状态"></a>4）随便进一个节点查看集群状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW STATUS LIKE &apos;%wsrep%&apos;;</span><br><span class="line">+------------------------------+-------------------------------------------------------------+</span><br><span class="line">| Variable_name                | Value                                                       |</span><br><span class="line">+------------------------------+-------------------------------------------------------------+</span><br><span class="line">| wsrep_local_state_uuid       | 54ebc9fd-f57f-11e5-baaa-96a1ced0928f                        |</span><br><span class="line">| wsrep_protocol_version       | 7                                                           |</span><br><span class="line">| wsrep_last_committed         | 0                                                           |</span><br><span class="line">| wsrep_replicated             | 0                                                           |</span><br><span class="line">| wsrep_replicated_bytes       | 0                                                           |</span><br><span class="line">| wsrep_repl_keys              | 0                                                           |</span><br><span class="line">| wsrep_repl_keys_bytes        | 0                                                           |</span><br><span class="line">| wsrep_repl_data_bytes        | 0                                                           |</span><br><span class="line">| wsrep_repl_other_bytes       | 0                                                           |</span><br><span class="line">| wsrep_received               | 10                                                          |</span><br><span class="line">| wsrep_received_bytes         | 784                                                         |</span><br><span class="line">| wsrep_local_commits          | 0                                                           |</span><br><span class="line">| wsrep_local_cert_failures    | 0                                                           |</span><br><span class="line">| wsrep_local_replays          | 0                                                           |</span><br><span class="line">| wsrep_local_send_queue       | 0                                                           |</span><br><span class="line">| wsrep_local_send_queue_max   | 1                                                           |</span><br><span class="line">| wsrep_local_send_queue_min   | 0                                                           |</span><br><span class="line">| wsrep_local_send_queue_avg   | 0.000000                                                    |</span><br><span class="line">| wsrep_local_recv_queue       | 0                                                           |</span><br><span class="line">| wsrep_local_recv_queue_max   | 1                                                           |</span><br><span class="line">| wsrep_local_recv_queue_min   | 0                                                           |</span><br><span class="line">| wsrep_local_recv_queue_avg   | 0.000000                                                    |</span><br><span class="line">| wsrep_local_cached_downto    | 0                                                           |</span><br><span class="line">| wsrep_flow_control_paused_ns | 0                                                           |</span><br><span class="line">| wsrep_flow_control_paused    | 0.000000                                                    |</span><br><span class="line">| wsrep_flow_control_sent      | 0                                                           |</span><br><span class="line">| wsrep_flow_control_recv      | 0                                                           |</span><br><span class="line">| wsrep_cert_deps_distance     | 0.000000                                                    |</span><br><span class="line">| wsrep_apply_oooe             | 0.000000                                                    |</span><br><span class="line">| wsrep_apply_oool             | 0.000000                                                    |</span><br><span class="line">| wsrep_apply_window           | 0.000000                                                    |</span><br><span class="line">| wsrep_commit_oooe            | 0.000000                                                    |</span><br><span class="line">| wsrep_commit_oool            | 0.000000                                                    |</span><br><span class="line">| wsrep_commit_window          | 0.000000                                                    |</span><br><span class="line">| wsrep_local_state            | 4                                                           |</span><br><span class="line">| wsrep_local_state_comment    | Synced                                                      |</span><br><span class="line">| wsrep_cert_index_size        | 0                                                           |</span><br><span class="line">| wsrep_cert_bucket_count      | 22                                                          |</span><br><span class="line">| wsrep_gcache_pool_size       | 1580                                                        |</span><br><span class="line">| wsrep_causal_reads           | 0                                                           |</span><br><span class="line">| wsrep_cert_interval          | 0.000000                                                    |</span><br><span class="line">| wsrep_incoming_addresses     | 192.168.42.135:3306,192.168.42.137:3306,192.168.42.136:3306 |</span><br><span class="line">| wsrep_evs_delayed            |                                                             |</span><br><span class="line">| wsrep_evs_evict_list         |                                                             |</span><br><span class="line">| wsrep_evs_repl_latency       | 0.00090448/0.00124879/0.00183671/0.000306234/6              |</span><br><span class="line">| wsrep_evs_state              | OPERATIONAL                                                 |</span><br><span class="line">| wsrep_gcomm_uuid             | 54e770a4-f57f-11e5-a4eb-1ae05e4a0e6e                        |</span><br><span class="line">| wsrep_cluster_conf_id        | 3                                                           |</span><br><span class="line">| wsrep_cluster_size           | 3                                                           |</span><br><span class="line">| wsrep_cluster_state_uuid     | 54ebc9fd-f57f-11e5-baaa-96a1ced0928f                        |</span><br><span class="line">| wsrep_cluster_status         | Primary                                                     |</span><br><span class="line">| wsrep_connected              | ON                                                          |</span><br><span class="line">| wsrep_local_bf_aborts        | 0                                                           |</span><br><span class="line">| wsrep_local_index            | 0                                                           |</span><br><span class="line">| wsrep_provider_name          | Galera                                                      |</span><br><span class="line">| wsrep_provider_vendor        | Codership Oy &lt;info@codership.com&gt;                           |</span><br><span class="line">| wsrep_provider_version       | 3.14(r53b88eb)                                              |</span><br><span class="line">| wsrep_ready                  | ON                                                          |</span><br><span class="line">| wsrep_thread_count           | 3                                                           |</span><br><span class="line">+------------------------------+-------------------------------------------------------------+</span><br><span class="line">59 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>这里PXC集群搭建完毕，可以在每个节点上进行读写，而且每个节点数据保证完整一致。</strong></p>
<h3 id="四、PXC集群测试"><a href="#四、PXC集群测试" class="headerlink" title="四、PXC集群测试"></a>四、PXC集群测试</h3><h4 id="1、基础测试"><a href="#1、基础测试" class="headerlink" title="1、基础测试"></a>1、基础测试</h4><h5 id="1）在135上："><a href="#1）在135上：" class="headerlink" title="1）在135上："></a>1）在135上：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database test_pxc;</span><br><span class="line">use test_pxc;</span><br><span class="line">create table test_pxc (id int,name char(10)) engine=innodb;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>
<h5 id="2）在136上："><a href="#2）在136上：" class="headerlink" title="2）在136上："></a>2）在136上：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use test_pxc</span><br><span class="line">insert into test_pxc values(1,&apos;test&apos;);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>
<h5 id="3）在137上："><a href="#3）在137上：" class="headerlink" title="3）在137上："></a>3）在137上：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use test_pxc;</span><br><span class="line">select * from test_pxc;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 | test |</span><br><span class="line">+------+------+</span><br></pre></td></tr></table></figure>
<h4 id="2、并发测试"><a href="#2、并发测试" class="headerlink" title="2、并发测试"></a>2、并发测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#创建一个测试表</span><br><span class="line">create table t2(id int(11),name varchar(20),time timestamp) engine=innodb;</span><br><span class="line">#写插入数据脚本</span><br><span class="line">vim in.sh</span><br><span class="line">#脚本内容</span><br><span class="line"># 插入大量测试数据</span><br><span class="line">#!/bin/bash</span><br><span class="line">for (( a=1 ; a&lt;=1000 ; a++  ))</span><br><span class="line">do</span><br><span class="line">            name=&quot;db6.$a&quot;</span><br><span class="line">                    mysql -e &quot;insert into test_pxc.t2 (name, time) values (\&quot;$name\&quot;, now())&quot;</span><br><span class="line">                done</span><br><span class="line">#将这个脚本拷贝到每个服务器上</span><br><span class="line">scp in.sh root@192.168.42.136:/zxh/scripts/</span><br><span class="line">scp in.sh root@192.168.42.137:/zxh/scripts/</span><br><span class="line">#3个节点同时执行插入数据（并发执行）</span><br><span class="line">#其中一个节点的一条数据出现死锁</span><br><span class="line">ERROR 1213 (40001) at line 1: Deadlock found when trying to get lock; try restarting transaction</span><br><span class="line">#查看表中数据，发现有一条数据没有插入</span><br><span class="line">mysql&gt; select count(*) from t2;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     3009 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>
<h4 id="3、宕机测试"><a href="#3、宕机测试" class="headerlink" title="3、宕机测试"></a>3、宕机测试</h4><p><strong>Tips：模拟出生产环境的样子，一边插入数据一边宕掉一个节点。</strong></p>
<h5 id="node1插入数据："><a href="#node1插入数据：" class="headerlink" title="node1插入数据："></a>node1插入数据：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./in.sh   //执行脚本，把量改为10000</span><br></pre></td></tr></table></figure>
<h5 id="node3查看是否在写入数据："><a href="#node3查看是否在写入数据：" class="headerlink" title="node3查看是否在写入数据："></a>node3查看是否在写入数据：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iotop</span><br></pre></td></tr></table></figure>
<h5 id="停掉node3上的percona实例："><a href="#停掉node3上的percona实例：" class="headerlink" title="停掉node3上的percona实例："></a>停掉node3上的percona实例：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node3 ~]# /etc/init.d/mysql stop</span><br><span class="line">Shutting down MySQL (Percona XtraDB Cluster)...... SUCCESS!</span><br></pre></td></tr></table></figure>
<h5 id="查看日志："><a href="#查看日志：" class="headerlink" title="查看日志："></a>查看日志：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">160330 14:45:44 [Note] WSREP: (71ee066c, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting on, nonlive peers: tcp://192.168.42.135:4567 tcp://192.168.42.136:4567 </span><br><span class="line">160330 14:45:45 [Note] WSREP: (71ee066c, &apos;tcp://0.0.0.0:4567&apos;) reconnecting to 54e770a4 (tcp://192.168.42.135:4567), attempt 0</span><br><span class="line">160330 14:45:49 [Note] WSREP: (71ee066c, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting off</span><br><span class="line">160330 14:46:15 [Note] /usr/sbin/mysqld: Normal shutdown</span><br><span class="line"></span><br><span class="line">160330 14:46:15 [Note] WSREP: Stop replication</span><br><span class="line">160330 14:46:15 [Note] WSREP: Closing send monitor...</span><br><span class="line">160330 14:46:15 [Note] WSREP: Closed send monitor.</span><br><span class="line">160330 14:46:15 [Note] WSREP: gcomm: terminating thread</span><br><span class="line">160330 14:46:15 [Note] WSREP: gcomm: joining thread</span><br><span class="line">160330 14:46:15 [Note] WSREP: gcomm: closing backend</span><br><span class="line">160330 14:46:15 [Note] WSREP: view(view_id(NON_PRIM,54e770a4,13) memb &#123;</span><br><span class="line">        71ee066c,0</span><br><span class="line">&#125; joined &#123;</span><br><span class="line">&#125; left &#123;</span><br><span class="line">&#125; partitioned &#123;</span><br><span class="line">        54e770a4,0</span><br><span class="line">        8ed58cb5,0</span><br><span class="line">&#125;)</span><br><span class="line">160330 14:46:15 [Note] WSREP: New COMPONENT: primary = no, bootstrap = no, my_idx = 0, memb_num = 1</span><br><span class="line">160330 14:46:15 [Note] WSREP: view((empty))</span><br><span class="line">160330 14:46:15 [Note] WSREP: gcomm: closed</span><br><span class="line">160330 14:46:15 [Note] WSREP: Flow-control interval: [16, 16]</span><br><span class="line">160330 14:46:15 [Note] WSREP: Received NON-PRIMARY.</span><br><span class="line">160330 14:46:15 [Note] WSREP: Shifting SYNCED -&gt; OPEN (TO: 40708)</span><br><span class="line">160330 14:46:15 [Note] WSREP: Received self-leave message.</span><br><span class="line">160330 14:46:15 [Note] WSREP: Flow-control interval: [0, 0]</span><br><span class="line">160330 14:46:15 [Note] WSREP: Received SELF-LEAVE. Closing connection.</span><br><span class="line">160330 14:46:15 [Note] WSREP: Shifting OPEN -&gt; CLOSED (TO: 40708)</span><br><span class="line">160330 14:46:15 [Note] WSREP: RECV thread exiting 0: Success</span><br><span class="line">160330 14:46:15 [Note] WSREP: recv_thread() joined.</span><br><span class="line">160330 14:46:15 [Note] WSREP: Closing replication queue.</span><br><span class="line">160330 14:46:15 [Note] WSREP: Closing slave action queue.</span><br><span class="line">160330 14:46:15 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708, view# -1: non-Primary, number of nodes: 1, my index: 0, protocol version 3</span><br><span class="line">160330 14:46:15 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</span><br><span class="line">160330 14:46:15 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708, view# -1: non-Primary, number of nodes: 0, my index: -1, protocol version 3</span><br><span class="line">160330 14:46:15 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</span><br><span class="line">160330 14:46:15 [Note] WSREP: applier thread exiting (code:0)</span><br><span class="line">160330 14:46:15 [Note] WSREP: applier thread exiting (code:6)</span><br><span class="line">160330 14:46:17 [Note] WSREP: killing local connection: 5</span><br><span class="line">160330 14:46:17 [Note] WSREP: rollbacker thread exiting</span><br><span class="line">160330 14:46:17 [Note] Event Scheduler: Purging the queue. 0 events</span><br><span class="line">160330 14:46:17 [Note] WSREP: dtor state: CLOSED</span><br><span class="line">160330 14:46:17 [Note] WSREP: mon: entered 17693 oooe fraction 0 oool fraction 0</span><br><span class="line">160330 14:46:17 [Note] WSREP: mon: entered 17693 oooe fraction 0.153224 oool fraction 0</span><br><span class="line">160330 14:46:17 [Note] WSREP: mon: entered 18109 oooe fraction 0 oool fraction 5.52212e-05</span><br><span class="line">160330 14:46:17 [Note] WSREP: cert index usage at exit 0</span><br><span class="line">160330 14:46:17 [Note] WSREP: cert trx map usage at exit 92</span><br><span class="line">160330 14:46:17 [Note] WSREP: deps set usage at exit 0</span><br><span class="line">160330 14:46:17 [Note] WSREP: avg deps dist 101.239</span><br><span class="line">160330 14:46:17 [Note] WSREP: avg cert interval 0</span><br><span class="line">160330 14:46:17 [Note] WSREP: cert index size 94</span><br><span class="line">160330 14:46:17 [Note] WSREP: Service thread queue flushed.</span><br><span class="line">160330 14:46:17 [Note] WSREP: wsdb trx map usage 0 conn query map usage 0</span><br><span class="line">160330 14:46:17 [Note] WSREP: MemPool(LocalTrxHandle): hit ratio: 0, misses: 0, in use: 0, in pool: 0</span><br><span class="line">160330 14:46:17 [Note] WSREP: MemPool(SlaveTrxHandle): hit ratio: 0.992087, misses: 140, in use: 0, in pool: 140</span><br><span class="line">160330 14:46:17 [Note] WSREP: Shifting CLOSED -&gt; DESTROYED (TO: 40708)</span><br><span class="line">160330 14:46:17 [Note] WSREP: Flushing memory map to disk...</span><br><span class="line">160330 14:46:18  InnoDB: Starting shutdown...</span><br><span class="line">160330 14:46:22  InnoDB: Shutdown completed; log sequence number 19929651</span><br><span class="line">160330 14:46:22 [Note] /usr/sbin/mysqld: Shutdown complete</span><br><span class="line"></span><br><span class="line">160330 14:46:22 mysqld_safe mysqld from pid file /var/lib/mysql/node3.pid ended</span><br></pre></td></tr></table></figure>
<h5 id="重新启动node3实例，并查看日志："><a href="#重新启动node3实例，并查看日志：" class="headerlink" title="重新启动node3实例，并查看日志："></a>重新启动node3实例，并查看日志：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">160330 15:02:13 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</span><br><span class="line">160330 15:02:13 mysqld_safe Skipping wsrep-recover for 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708 pair</span><br><span class="line">160330 15:02:13 mysqld_safe Assigning 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708 to wsrep_start_position</span><br><span class="line">160330 15:02:13 [Note] WSREP: wsrep_start_position var submitted: &apos;54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708&apos;</span><br><span class="line">160330 15:02:13 [Note] WSREP: Read nil XID from storage engines, skipping position init</span><br><span class="line">160330 15:02:13 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib64/libgalera_smm.so&apos;</span><br><span class="line">160330 15:02:14 [Note] WSREP: wsrep_load(): Galera 3.14(r53b88eb) by Codership Oy &lt;info@codership.com&gt; loaded successfully.</span><br><span class="line">160330 15:02:14 [Note] WSREP: CRC-32C: using hardware acceleration.</span><br><span class="line">160330 15:02:14 [Note] WSREP: Found saved state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</span><br><span class="line">160330 15:02:14 [Note] WSREP: Passing config to GCS: base_dir = /var/lib/mysql/; base_host = 192.168.42.137; base_port = 4567; cert.log_conflicts = no; debug = no; evs.auto_evict = 0; evs.delay_margin = PT1S; evs.delayed_keep_period = PT30S; evs.inactive_check_period = PT0.5S; evs.inactive_timeout = PT15S; evs.join_retrans_period = PT1S; evs.max_install_timeouts = 3; evs.send_window = 4; evs.stats_report_period = PT1M; evs.suspect_timeout = PT5S; evs.user_send_window = 2; evs.view_forget_timeout = PT24H; gcache.dir = /var/lib/mysql/; gcache.keep_pages_count = 0; gcache.keep_pages_size = 0; gcache.mem_size = 0; gcache.name = /var/lib/mysql//galera.cache; gcache.page_size = 128M; gcache.size = 128M; gcs.fc_debug = 0; gcs.fc_factor = 1.0; gcs.fc_limit = 16; gcs.fc_master_slave = no; gcs.max_packet_size = 64500; gcs.max_throttle = 0.25; gcs.recv_q_hard_limit = 9223372036854775807; gcs.recv_q_soft_limit = 0.25; gcs.sync_donor = no; gmcast.segment = 0; gmcast.version = 0; pc.announce_timeout = PT3S; pc.checksum = false; pc.ignore_quorum</span><br><span class="line">160330 15:02:14 [Note] WSREP: Service thread queue flushed.</span><br><span class="line">160330 15:02:14 [Note] WSREP: Assign initial position for certification: 40708, protocol version: -1</span><br><span class="line">160330 15:02:14 [Note] WSREP: wsrep_sst_grab()</span><br><span class="line">160330 15:02:14 [Note] WSREP: Start replication</span><br><span class="line">160330 15:02:14 [Note] WSREP: Setting initial position to 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</span><br><span class="line">160330 15:02:14 [Note] WSREP: protonet asio version 0</span><br><span class="line">160330 15:02:14 [Note] WSREP: Using CRC-32C for message checksums.</span><br><span class="line">160330 15:02:14 [Note] WSREP: backend: asio</span><br><span class="line">160330 15:02:14 [Warning] WSREP: access file(/var/lib/mysql//gvwstate.dat) failed(No such file or directory)</span><br><span class="line">160330 15:02:14 [Note] WSREP: restore pc from disk failed</span><br><span class="line">160330 15:02:14 [Note] WSREP: GMCast version 0</span><br><span class="line">160330 15:02:14 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567</span><br><span class="line">160330 15:02:14 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1</span><br><span class="line">160330 15:02:14 [Note] WSREP: EVS version 0</span><br><span class="line">160330 15:02:14 [Note] WSREP: gcomm: connecting to group &apos;Percona&apos;, peer &apos;192.168.42.135:,192.168.42.136:,192.168.42.137:&apos;</span><br><span class="line">160330 15:02:14 [Warning] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) address &apos;tcp://192.168.42.137:4567&apos; points to own listening address, blacklisting</span><br><span class="line">160330 15:02:14 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting on, nonlive peers: </span><br><span class="line">160330 15:02:14 [Note] WSREP: declaring 54e770a4 at tcp://192.168.42.135:4567 stable</span><br><span class="line">160330 15:02:14 [Note] WSREP: declaring 8ed58cb5 at tcp://192.168.42.136:4567 stable</span><br><span class="line">160330 15:02:14 [Note] WSREP: Node 54e770a4 state prim</span><br><span class="line">160330 15:02:14 [Note] WSREP: view(view_id(PRIM,54e56db5,15) memb &#123;</span><br><span class="line">        54e56db5,0</span><br><span class="line">        54e770a4,0</span><br><span class="line">        8ed58cb5,0</span><br><span class="line">&#125; joined &#123;</span><br><span class="line">&#125; left &#123;</span><br><span class="line">&#125; partitioned &#123;</span><br><span class="line">&#125;)</span><br><span class="line">160330 15:02:14 [Note] WSREP: save pc into disk</span><br><span class="line">160330 15:02:15 [Note] WSREP: gcomm: connected</span><br><span class="line">160330 15:02:15 [Note] WSREP: Changing maximum packet size to 64500, resulting msg size: 32636</span><br><span class="line">160330 15:02:15 [Note] WSREP: Shifting CLOSED -&gt; OPEN (TO: 0)</span><br><span class="line">160330 15:02:15 [Note] WSREP: Opened channel &apos;Percona&apos;</span><br><span class="line">160330 15:02:15 [Note] WSREP: Waiting for SST to complete.</span><br><span class="line">160330 15:02:15 [Note] WSREP: New COMPONENT: primary = yes, bootstrap = no, my_idx = 0, memb_num = 3</span><br><span class="line">160330 15:02:15 [Note] WSREP: STATE_EXCHANGE: sent state UUID: 55870069-f645-11e5-baaa-5a660b7a7175</span><br><span class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: sent state msg: 55870069-f645-11e5-baaa-5a660b7a7175</span><br><span class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: got state msg: 55870069-f645-11e5-baaa-5a660b7a7175 from 0 (node3)</span><br><span class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: got state msg: 55870069-f645-11e5-baaa-5a660b7a7175 from 2 (node2)</span><br><span class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: got state msg: 55870069-f645-11e5-baaa-5a660b7a7175 from 1 (node1)</span><br><span class="line">160330 15:02:15 [Note] WSREP: Quorum results:</span><br><span class="line">        version    = 3,</span><br><span class="line">        component  = PRIMARY,</span><br><span class="line">        conf_id    = 9,</span><br><span class="line">        members    = 2/3 (joined/total),</span><br><span class="line">        act_id     = 53016,</span><br><span class="line">        last_appl. = -1,</span><br><span class="line">        protocols  = 0/7/3 (gcs/repl/appl),</span><br><span class="line">        group UUID = 54ebc9fd-f57f-11e5-baaa-96a1ced0928f</span><br><span class="line">160330 15:02:15 [Note] WSREP: Flow-control interval: [28, 28]</span><br><span class="line">160330 15:02:15 [Note] WSREP: Shifting OPEN -&gt; PRIMARY (TO: 53016)</span><br><span class="line">160330 15:02:15 [Note] WSREP: State transfer required: </span><br><span class="line">        Group state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016</span><br><span class="line">        Local state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</span><br><span class="line">160330 15:02:15 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016, view# 10: Primary, number of nodes: 3, my index: 0, protocol version 3</span><br><span class="line">160330 15:02:15 [Warning] WSREP: Gap in state sequence. Need state transfer.</span><br><span class="line">160330 15:02:15 [Note] WSREP: Running: &apos;wsrep_sst_xtrabackup-v2 --role &apos;joiner&apos; --address &apos;192.168.42.137&apos; --auth &apos;sst:123456&apos; --datadir &apos;/var/lib/mysql/&apos; --defaults-file &apos;/etc/my.cnf&apos; --parent &apos;28735&apos;&apos;</span><br><span class="line">WSREP_SST: [INFO] Streaming with xbstream (20160330 15:02:16.388)</span><br><span class="line">WSREP_SST: [INFO] Using socat as streamer (20160330 15:02:16.393)</span><br><span class="line">WSREP_SST: [INFO] Evaluating timeout -s9 100 socat -u TCP-LISTEN:4444,reuseaddr stdio | xbstream -x; RC=( $&#123;PIPESTATUS[@]&#125; ) (20160330 15:02:16.677)</span><br><span class="line">160330 15:02:16 [Note] WSREP: Prepared SST request: xtrabackup-v2|192.168.42.137:4444/xtrabackup_sst</span><br><span class="line">160330 15:02:16 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</span><br><span class="line">160330 15:02:16 [Note] WSREP: REPL Protocols: 7 (3, 2)</span><br><span class="line">160330 15:02:16 [Note] WSREP: Service thread queue flushed.</span><br><span class="line">160330 15:02:16 [Note] WSREP: Assign initial position for certification: 53016, protocol version: 3</span><br><span class="line">160330 15:02:16 [Note] WSREP: Service thread queue flushed.</span><br><span class="line">2016/03/30 15:02:16 socat[29014] E bind(3, &#123;AF=2 0.0.0.0:4444&#125;, 16): Address already in use</span><br><span class="line">160330 15:02:16 [Note] WSREP: Prepared IST receiver, listening at: tcp://192.168.42.137:4568</span><br><span class="line">160330 15:02:16 [Note] WSREP: Member 0.0 (node3) requested state transfer from &apos;*any*&apos;. Selected 2.0 (node2)(SYNCED) as donor.</span><br><span class="line">160330 15:02:16 [Note] WSREP: Shifting PRIMARY -&gt; JOINER (TO: 53016)</span><br><span class="line">160330 15:02:16 [Note] WSREP: Requesting state transfer: success, donor: 2</span><br><span class="line">WSREP_SST: [ERROR] Error while getting data from donor node:  exit codes: 1 0 (20160330 15:02:16.833)</span><br><span class="line">WSREP_SST: [ERROR] Cleanup after exit with status:32 (20160330 15:02:16.841)</span><br><span class="line">160330 15:02:16 [ERROR] WSREP: Process completed with error: wsrep_sst_xtrabackup-v2 --role &apos;joiner&apos; --address &apos;192.168.42.137&apos; --auth &apos;sst:123456&apos; --datadir &apos;/var/lib/mysql/&apos; --defaults-file &apos;/etc/my.cnf&apos; --parent &apos;28735&apos;: 32 (Broken pipe)</span><br><span class="line">160330 15:02:16 [ERROR] WSREP: Failed to read uuid:seqno from joiner script.</span><br><span class="line">160330 15:02:16 [ERROR] WSREP: SST failed: 32 (Broken pipe)</span><br><span class="line">160330 15:02:16 [ERROR] Aborting</span><br><span class="line">160330 15:02:17 [Note] WSREP: 2.0 (node2): State transfer to 0.0 (node3) complete.</span><br><span class="line">160330 15:02:17 [Note] WSREP: Member 2.0 (node2) synced with group.</span><br><span class="line">xbstream: Can&apos;t create/write to file &apos;./xtrabackup_galera_info&apos; (Errcode: 2 - No such file or directory)</span><br><span class="line">xbstream: failed to create file.</span><br><span class="line">160330 15:02:17 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting off</span><br><span class="line">160330 15:02:18 [Note] WSREP: Closing send monitor...</span><br><span class="line">160330 15:02:18 [Note] WSREP: Closed send monitor.</span><br><span class="line">160330 15:02:18 [Note] WSREP: gcomm: terminating thread</span><br><span class="line">160330 15:02:18 [Note] WSREP: gcomm: joining thread</span><br><span class="line">160330 15:02:18 [Note] WSREP: gcomm: closing backend</span><br><span class="line">160330 15:02:18 [Note] WSREP: view(view_id(NON_PRIM,54e56db5,15) memb &#123;</span><br><span class="line">        54e56db5,0</span><br><span class="line">&#125; joined &#123;</span><br><span class="line">&#125; left &#123;</span><br><span class="line">&#125; partitioned &#123;</span><br><span class="line">        54e770a4,0</span><br><span class="line">        8ed58cb5,0</span><br><span class="line">&#125;)</span><br><span class="line">160330 15:02:18 [Note] WSREP: New COMPONENT: primary = no, bootstrap = no, my_idx = 0, memb_num = 1</span><br><span class="line">160330 15:02:18 [Note] WSREP: view((empty))</span><br><span class="line">160330 15:02:18 [Note] WSREP: gcomm: closed</span><br><span class="line">160330 15:02:18 [Note] WSREP: Flow-control interval: [16, 16]</span><br><span class="line">160330 15:02:18 [Note] WSREP: Received NON-PRIMARY.</span><br><span class="line">160330 15:02:18 [Note] WSREP: Shifting JOINER -&gt; OPEN (TO: 53016)</span><br><span class="line">160330 15:02:18 [Note] WSREP: Received self-leave message.</span><br><span class="line">160330 15:02:18 [Note] WSREP: Flow-control interval: [0, 0]</span><br><span class="line">160330 15:02:18 [Note] WSREP: Received SELF-LEAVE. Closing connection.</span><br><span class="line">160330 15:02:18 [Note] WSREP: Shifting OPEN -&gt; CLOSED (TO: 53016)</span><br><span class="line">160330 15:02:18 [Note] WSREP: RECV thread exiting 0: Success</span><br><span class="line">160330 15:02:18 [Note] WSREP: recv_thread() joined.</span><br><span class="line">160330 15:02:18 [Note] WSREP: Closing replication queue.</span><br><span class="line">160330 15:02:18 [Note] WSREP: Closing slave action queue.</span><br><span class="line">160330 15:02:18 [Note] WSREP: Service disconnected.</span><br><span class="line">160330 15:02:18 [Note] WSREP: rollbacker thread exiting</span><br><span class="line">160330 15:02:19 [Note] WSREP: Some threads may fail to exit.</span><br><span class="line">160330 15:02:19 [Note] /usr/sbin/mysqld: Shutdown complete</span><br><span class="line"></span><br><span class="line">Error in my_thread_global_end(): 1 threads didn&apos;t exit</span><br><span class="line">160330 15:02:25 mysqld_safe mysqld from pid file /var/lib/mysql/node3.pid ended</span><br></pre></td></tr></table></figure>
<h5 id="第一次启动失败，再次启动实例，并查看日志："><a href="#第一次启动失败，再次启动实例，并查看日志：" class="headerlink" title="第一次启动失败，再次启动实例，并查看日志："></a>第一次启动失败，再次启动实例，并查看日志：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">160330 15:02:58 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</span><br><span class="line">160330 15:02:58 mysqld_safe WSREP: Running position recovery with --log_error=&apos;/var/lib/mysql/wsrep_recovery.PfWoiQ&apos; --pid-file=&apos;/var/lib/mysql/node3-recover.pid&apos;</span><br><span class="line">160330 15:03:01 mysqld_safe WSREP: Recovered position 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</span><br><span class="line">160330 15:03:01 [Note] WSREP: wsrep_start_position var submitted: &apos;54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708&apos;</span><br><span class="line">160330 15:03:01 [Note] WSREP: Read nil XID from storage engines, skipping position init</span><br><span class="line">160330 15:03:01 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib64/libgalera_smm.so&apos;</span><br><span class="line">160330 15:03:01 [Note] WSREP: wsrep_load(): Galera 3.14(r53b88eb) by Codership Oy &lt;info@codership.com&gt; loaded successfully.</span><br><span class="line">160330 15:03:01 [Note] WSREP: CRC-32C: using hardware acceleration.</span><br><span class="line">160330 15:03:01 [Note] WSREP: Found saved state: 00000000-0000-0000-0000-000000000000:-1</span><br><span class="line">160330 15:03:01 [Note] WSREP: Passing config to GCS: base_dir = /var/lib/mysql/; base_host = 192.168.42.137; base_port = 4567; cert.log_conflicts = no; debug = no; evs.auto_evict = 0; evs.delay_margin = PT1S; evs.delayed_keep_period = PT30S; evs.inactive_check_period = PT0.5S; evs.inactive_timeout = PT15S; evs.join_retrans_period = PT1S; evs.max_install_timeouts = 3; evs.send_window = 4; evs.stats_report_period = PT1M; evs.suspect_timeout = PT5S; evs.user_send_window = 2; evs.view_forget_timeout = PT24H; gcache.dir = /var/lib/mysql/; gcache.keep_pages_count = 0; gcache.keep_pages_size = 0; gcache.mem_size = 0; gcache.name = /var/lib/mysql//galera.cache; gcache.page_size = 128M; gcache.size = 128M; gcs.fc_debug = 0; gcs.fc_factor = 1.0; gcs.fc_limit = 16; gcs.fc_master_slave = no; gcs.max_packet_size = 64500; gcs.max_throttle = 0.25; gcs.recv_q_hard_limit = 9223372036854775807; gcs.recv_q_soft_limit = 0.25; gcs.sync_donor = no; gmcast.segment = 0; gmcast.version = 0; pc.announce_timeout = PT3S; pc.checksum = false; pc.ignore_quorum</span><br><span class="line">160330 15:03:01 [Note] WSREP: Service thread queue flushed.</span><br><span class="line">160330 15:03:01 [Note] WSREP: Assign initial position for certification: -1, protocol version: -1</span><br><span class="line">160330 15:03:01 [Note] WSREP: wsrep_sst_grab()</span><br><span class="line">160330 15:03:01 [Note] WSREP: Start replication</span><br><span class="line">160330 15:03:01 [Note] WSREP: Setting initial position to 00000000-0000-0000-0000-000000000000:-1</span><br><span class="line">160330 15:03:01 [Note] WSREP: protonet asio version 0</span><br><span class="line">160330 15:03:01 [Note] WSREP: Using CRC-32C for message checksums.</span><br><span class="line">160330 15:03:01 [Note] WSREP: backend: asio</span><br><span class="line">160330 15:03:01 [Warning] WSREP: access file(/var/lib/mysql//gvwstate.dat) failed(No such file or directory)</span><br><span class="line">160330 15:03:01 [Note] WSREP: restore pc from disk failed</span><br><span class="line">160330 15:03:01 [Note] WSREP: GMCast version 0</span><br><span class="line">160330 15:03:01 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567</span><br><span class="line">160330 15:03:01 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1</span><br><span class="line">160330 15:03:01 [Note] WSREP: EVS version 0</span><br><span class="line">160330 15:03:01 [Note] WSREP: gcomm: connecting to group &apos;Percona&apos;, peer &apos;192.168.42.135:,192.168.42.136:,192.168.42.137:&apos;</span><br><span class="line">160330 15:03:01 [Warning] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) address &apos;tcp://192.168.42.137:4567&apos; points to own listening address, blacklisting</span><br><span class="line">160330 15:03:01 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting on, nonlive peers: </span><br><span class="line">160330 15:03:03 [Note] WSREP: declaring 54e770a4 at tcp://192.168.42.135:4567 stable</span><br><span class="line">160330 15:03:03 [Note] WSREP: declaring 8ed58cb5 at tcp://192.168.42.136:4567 stable</span><br><span class="line">160330 15:03:03 [Note] WSREP: Node 54e770a4 state prim</span><br><span class="line">160330 15:03:03 [Note] WSREP: view(view_id(PRIM,54e770a4,17) memb &#123;</span><br><span class="line">        54e770a4,0</span><br><span class="line">        711791c3,0</span><br><span class="line">        8ed58cb5,0</span><br><span class="line">&#125; joined &#123;</span><br><span class="line">&#125; left &#123;</span><br><span class="line">&#125; partitioned &#123;</span><br><span class="line">&#125;)</span><br><span class="line">160330 15:03:03 [Note] WSREP: save pc into disk</span><br><span class="line">160330 15:03:03 [Note] WSREP: gcomm: connected</span><br><span class="line">160330 15:03:03 [Note] WSREP: Changing maximum packet size to 64500, resulting msg size: 32636</span><br><span class="line">160330 15:03:03 [Note] WSREP: Shifting CLOSED -&gt; OPEN (TO: 0)</span><br><span class="line">160330 15:03:03 [Note] WSREP: Opened channel &apos;Percona&apos;</span><br><span class="line">160330 15:03:03 [Note] WSREP: Waiting for SST to complete.</span><br><span class="line">160330 15:03:03 [Note] WSREP: New COMPONENT: primary = yes, bootstrap = no, my_idx = 1, memb_num = 3</span><br><span class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: Waiting for state UUID.</span><br><span class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: sent state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82</span><br><span class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: got state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82 from 2 (node2)</span><br><span class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: got state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82 from 0 (node1)</span><br><span class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: got state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82 from 1 (node3)</span><br><span class="line">160330 15:03:03 [Note] WSREP: Quorum results:</span><br><span class="line">        version    = 3,</span><br><span class="line">        component  = PRIMARY,</span><br><span class="line">        conf_id    = 11,</span><br><span class="line">        members    = 2/3 (joined/total),</span><br><span class="line">        act_id     = 53016,</span><br><span class="line">        last_appl. = -1,</span><br><span class="line">        protocols  = 0/7/3 (gcs/repl/appl),</span><br><span class="line">        group UUID = 54ebc9fd-f57f-11e5-baaa-96a1ced0928f</span><br><span class="line">160330 15:03:03 [Note] WSREP: Flow-control interval: [28, 28]</span><br><span class="line">160330 15:03:03 [Note] WSREP: Shifting OPEN -&gt; PRIMARY (TO: 53016)</span><br><span class="line">160330 15:03:03 [Note] WSREP: State transfer required: </span><br><span class="line">        Group state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016</span><br><span class="line">        Local state: 00000000-0000-0000-0000-000000000000:-1</span><br><span class="line">160330 15:03:03 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016, view# 12: Primary, number of nodes: 3, my index: 1, protocol version 3</span><br><span class="line">160330 15:03:03 [Warning] WSREP: Gap in state sequence. Need state transfer.</span><br><span class="line">160330 15:03:03 [Note] WSREP: Running: &apos;wsrep_sst_xtrabackup-v2 --role &apos;joiner&apos; --address &apos;192.168.42.137&apos; --auth &apos;sst:123456&apos; --datadir &apos;/var/lib/mysql/&apos; --defaults-file &apos;/etc/my.cnf&apos; --parent &apos;29374&apos;&apos;</span><br><span class="line">WSREP_SST: [INFO] Streaming with xbstream (20160330 15:03:03.892)</span><br><span class="line">WSREP_SST: [INFO] Using socat as streamer (20160330 15:03:03.897)</span><br><span class="line">WSREP_SST: [INFO] Stale sst_in_progress file: /var/lib/mysql//sst_in_progress (20160330 15:03:03.907)</span><br><span class="line">WSREP_SST: [INFO] Evaluating timeout -s9 100 socat -u TCP-LISTEN:4444,reuseaddr stdio | xbstream -x; RC=( $&#123;PIPESTATUS[@]&#125; ) (20160330 15:03:03.985)</span><br><span class="line">160330 15:03:04 [Note] WSREP: Prepared SST request: xtrabackup-v2|192.168.42.137:4444/xtrabackup_sst</span><br><span class="line">160330 15:03:04 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</span><br><span class="line">160330 15:03:04 [Note] WSREP: REPL Protocols: 7 (3, 2)</span><br><span class="line">160330 15:03:04 [Note] WSREP: Service thread queue flushed.</span><br><span class="line">160330 15:03:04 [Note] WSREP: Assign initial position for certification: 53016, protocol version: 3</span><br><span class="line">160330 15:03:04 [Note] WSREP: Service thread queue flushed.</span><br><span class="line">160330 15:03:04 [Warning] WSREP: Failed to prepare for incremental state transfer: Local state UUID (00000000-0000-0000-0000-000000000000) does not match group state UUID (54ebc9fd-f57f-11e5-baaa-96a1ced0928f): 1 (Operation not permitted)</span><br><span class="line">         at galera/src/replicator_str.cpp:prepare_for_IST():489. IST will be unavailable.</span><br><span class="line">160330 15:03:04 [Note] WSREP: Member 1.0 (node3) requested state transfer from &apos;*any*&apos;. Selected 0.0 (node1)(SYNCED) as donor.</span><br><span class="line">160330 15:03:04 [Note] WSREP: Shifting PRIMARY -&gt; JOINER (TO: 53016)</span><br><span class="line">160330 15:03:04 [Note] WSREP: Requesting state transfer: success, donor: 0</span><br><span class="line">160330 15:03:05 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting off</span><br><span class="line">WSREP_SST: [INFO] Evaluating socat -u TCP-LISTEN:4444,reuseaddr stdio | xbstream -x; RC=( $&#123;PIPESTATUS[@]&#125; ) (20160330 15:03:05.519)</span><br><span class="line">WSREP_SST: [INFO] Proceeding with SST (20160330 15:03:05.538)</span><br><span class="line">WSREP_SST: [INFO] Cleaning the existing datadir and innodb-data/log directories (20160330 15:03:05.542)</span><br><span class="line">removed `/var/lib/mysql/test/db.opt&apos;</span><br><span class="line">removed directory: `/var/lib/mysql/test&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql.sock&apos;</span><br><span class="line">removed `/var/lib/mysql/ibdata1&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/rwlock_instances.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/cond_instances.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/file_summary_by_instance.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/performance_timers.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/events_waits_current.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/setup_timers.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/setup_consumers.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/file_instances.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/mutex_instances.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/threads.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/events_waits_history_long.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/setup_instruments.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/events_waits_history.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/db.opt&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/events_waits_summary_by_instance.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/events_waits_summary_by_thread_by_event_name.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/events_waits_summary_global_by_event_name.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/performance_schema/file_summary_by_event_name.frm&apos;</span><br><span class="line">removed directory: `/var/lib/mysql/performance_schema&apos;</span><br><span class="line">removed `/var/lib/mysql/ib_logfile1&apos;</span><br><span class="line">removed `/var/lib/mysql/test_pxc/test_pxc.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/test_pxc/db.opt&apos;</span><br><span class="line">removed `/var/lib/mysql/test_pxc/t2.frm&apos;</span><br><span class="line">removed directory: `/var/lib/mysql/test_pxc&apos;</span><br><span class="line">removed `/var/lib/mysql/xtrabackup_info&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/slow_log.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/proxies_priv.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/func.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/servers.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_transition.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_transition_type.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/slow_log.CSM&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/user.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/ndb_binlog_index.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/db.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/columns_priv.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/ndb_binlog_index.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_transition_type.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/tables_priv.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_topic.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_keyword.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_topic.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/columns_priv.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/plugin.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/event.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_category.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_keyword.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/slow_log.CSV&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/procs_priv.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/columns_priv.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/ndb_binlog_index.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_name.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_keyword.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/proc.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_relation.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/procs_priv.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/func.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_leap_second.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/event.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/event.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_name.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_transition_type.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/host.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_transition.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/servers.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/user.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_relation.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_category.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/general_log.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/plugin.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_transition.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_name.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/host.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_relation.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/proc.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/general_log.CSM&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_leap_second.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/db.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone_leap_second.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/procs_priv.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/general_log.CSV&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/host.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/db.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/tables_priv.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/proxies_priv.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/proc.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/func.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_category.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/tables_priv.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/proxies_priv.frm&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/plugin.MYI&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/user.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/time_zone.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/help_topic.MYD&apos;</span><br><span class="line">removed `/var/lib/mysql/mysql/servers.frm&apos;</span><br><span class="line">removed directory: `/var/lib/mysql/mysql&apos;</span><br><span class="line">removed `/var/lib/mysql/ib_logfile0&apos;</span><br><span class="line">WSREP_SST: [INFO] Waiting for SST streaming to complete! (20160330 15:03:05.630)</span><br><span class="line">160330 15:03:18 [Note] WSREP: 0.0 (node1): State transfer to 1.0 (node3) complete.</span><br><span class="line">160330 15:03:18 [Note] WSREP: Member 0.0 (node1) synced with group.</span><br><span class="line">WSREP_SST: [INFO] Preparing the backup at /var/lib/mysql//.sst (20160330 15:03:19.498)</span><br><span class="line">WSREP_SST: [INFO] Evaluating innobackupex --no-version-check  --apply-log $rebuildcmd $&#123;DATA&#125; &amp;&gt;$&#123;DATA&#125;/innobackup.prepare.log (20160330 15:03:19.503)</span><br><span class="line">WSREP_SST: [INFO] Moving the backup to /var/lib/mysql/ (20160330 15:03:23.348)</span><br><span class="line">WSREP_SST: [INFO] Evaluating innobackupex --defaults-file=/etc/my.cnf --no-version-check   --move-back --force-non-empty-directories $&#123;DATA&#125; &amp;&gt;$&#123;DATA&#125;/innobackup.move.log (20160330 15:03:23.354)</span><br><span class="line">WSREP_SST: [INFO] Move successful, removing /var/lib/mysql//.sst (20160330 15:03:23.377)</span><br><span class="line">WSREP_SST: [INFO] Galera co-ords from recovery: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016 (20160330 15:03:23.416)</span><br><span class="line">WSREP_SST: [INFO] Total time on joiner: 0 seconds (20160330 15:03:23.423)</span><br><span class="line">WSREP_SST: [INFO] Removing the sst_in_progress file (20160330 15:03:23.430)</span><br><span class="line">160330 15:03:23 [Note] WSREP: SST complete, seqno: 53016</span><br><span class="line">160330 15:03:23 [Note] Plugin &apos;FEDERATED&apos; is disabled.</span><br><span class="line">160330 15:03:23 InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">160330 15:03:23 InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">160330 15:03:23 InnoDB: Compressed tables use zlib 1.2.3</span><br><span class="line">160330 15:03:23 InnoDB: Using Linux native AIO</span><br><span class="line">160330 15:03:23 InnoDB: Initializing buffer pool, size = 128.0M</span><br><span class="line">160330 15:03:23 InnoDB: Completed initialization of buffer pool</span><br><span class="line">160330 15:03:23 InnoDB: highest supported file format is Barracuda.</span><br><span class="line">160330 15:03:23  InnoDB: Waiting for the background threads to start</span><br><span class="line">160330 15:03:24 Percona XtraDB (http://www.percona.com) 5.5.41-37.0 started; log sequence number 25433110</span><br><span class="line">160330 15:03:25 [Note] Event Scheduler: Loaded 0 events</span><br><span class="line">160330 15:03:25 [Note] WSREP: Signalling provider to continue.</span><br><span class="line">160330 15:03:25 [Note] WSREP: SST received: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016</span><br><span class="line">160330 15:03:25 [Note] /usr/sbin/mysqld: ready for connections.</span><br><span class="line">Version: &apos;5.5.41-37.0-55&apos;  socket: &apos;/var/lib/mysql/mysql.sock&apos;  port: 3306  Percona XtraDB Cluster (GPL), Release rel37.0, Revision 853, WSREP version 25.11, wsrep_25.11.r4027</span><br><span class="line">160330 15:03:25 [Note] WSREP: 1.0 (node3): State transfer from 0.0 (node1) complete.</span><br><span class="line">160330 15:03:25 [Note] WSREP: Shifting JOINER -&gt; JOINED (TO: 53016)</span><br><span class="line">160330 15:03:25 [Note] WSREP: Member 1.0 (node3) synced with group.</span><br><span class="line">160330 15:03:25 [Note] WSREP: Shifting JOINED -&gt; SYNCED (TO: 53016)</span><br><span class="line">160330 15:03:25 [Note] WSREP: Synchronized with group, ready for connections</span><br><span class="line">160330 15:03:25 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</span><br></pre></td></tr></table></figure>
<p><strong>使用sst进行同步后，成功加入集群，上面日志可以看出同步过程。</strong></p>
<h4 id="4、误删除测试"><a href="#4、误删除测试" class="headerlink" title="4、误删除测试"></a>4、误删除测试</h4><h5 id="删除node3上面的数据库文件："><a href="#删除node3上面的数据库文件：" class="headerlink" title="删除node3上面的数据库文件："></a>删除<code>node3</code>上面的数据库文件：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/lib/mysql/test_pxc/</span><br><span class="line">#tips：生产环境删除东西别用-rf这个参数</span><br></pre></td></tr></table></figure>
<h5 id="查看数据库，已经没有了test-pxc这个数据库："><a href="#查看数据库，已经没有了test-pxc这个数据库：" class="headerlink" title="查看数据库，已经没有了test_pxc这个数据库："></a>查看数据库，已经没有了<code>test_pxc</code>这个数据库：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>
<h5 id="对node3上的数据库重启，SST恢复数据："><a href="#对node3上的数据库重启，SST恢复数据：" class="headerlink" title="对node3上的数据库重启，SST恢复数据："></a>对node3上的数据库重启，SST恢复数据：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node3 mysql]# /etc/init.d/mysql restart</span><br><span class="line">Shutting down MySQL (Percona XtraDB Cluster) ERROR! MySQL (Percona XtraDB Cluster) server process #30193 is not running!</span><br><span class="line">Starting MySQL (Percona XtraDB Cluster).......State transfer in progress, setting sleep higher</span><br><span class="line">... SUCCESS!</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">| test_pxc           |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>数据恢复过程和宕机测试时的过程差不多。</strong></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2016/04/22/Mysql Inception/" style="float: left;">
        ← 搭建Mysql Inception
    </a>
    
    
    <a class="pull-right" href="/2016/04/08/HEXO+Github/">
        HEXO+Github,搭建属于自己的博客 →
    </a>
    
</nav>

        <div class="duoshuo">
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2016/04/08/PXC/" data-title="PXC集群搭建" data-url="http://yoursite.com/2016/04/08/PXC/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ancientmoonhu"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Zaki. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
